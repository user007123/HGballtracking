<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>HoverGreens Vision ‚Äî Camera Boot</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />

<style>
  body { margin:0; background:#000; color:#fff; font-family:Arial,sans-serif; }
  .wrap { max-width:1180px; margin:20px auto; text-align:center; }
  select, button { padding:10px 14px; font-size:16px; margin:6px; background:#111; color:#fff; border:1px solid #444; border-radius:6px; }
  button.primary { border-color:#2ecc71; }
  #status { margin-top:8px; font-size:14px; color:#0f0; white-space:pre-wrap; }
  video { display:none; }
  canvas { display:block; width:1180px; height:370px; margin:12px auto; background:#111; }
</style>

<script async src="https://docs.opencv.org/4.x/opencv.js"></script>
</head>
<body>

<div class="wrap">
  <h2>HoverGreens Vision ‚Äî Live Camera</h2>

  <select id="cameraSelect"></select>
  <button id="startBtn" class="primary">Start Camera</button>

  <div id="status">Loading cameras‚Ä¶</div>

  <video id="video" autoplay playsinline></video>
  <canvas id="canvas" width="1180" height="370"></canvas>
</div>

<script>
/* Elements */
const camSelect = document.getElementById("cameraSelect");
const startBtn  = document.getElementById("startBtn");
const video     = document.getElementById("video");
const canvas    = document.getElementById("canvas");
const ctx       = canvas.getContext("2d");
const statusEl  = document.getElementById("status");

function setStatus(msg){ statusEl.textContent = msg; }

/* ‚úÖ Load camera list */
async function loadCameras(){
  try {
    await navigator.mediaDevices.getUserMedia({video:true});
    const devices = await navigator.mediaDevices.enumerateDevices();
    const cams = devices.filter(d => d.kind === "videoinput");

    camSelect.innerHTML = "";
    cams.forEach((cam,i)=>{
      const opt = document.createElement("option");
      opt.value = cam.deviceId;
      opt.text  = cam.label || `Camera ${i+1}`;
      camSelect.appendChild(opt);
    });

    setStatus("‚úÖ Cameras detected ‚Äî select one & click Start");

  } catch(e){
    setStatus("‚ùå Camera permission required ‚Äî enable in browser settings.");
  }
}
loadCameras();

/* ‚úÖ Start selected camera */
async function startCamera(){
  const camId = camSelect.value;
  setStatus("üé• Starting camera‚Ä¶");

  try {
    const stream = await navigator.mediaDevices.getUserMedia({
      video:{ deviceId:{ exact:camId }}
    });

    video.srcObject = stream;

    await video.play().catch(()=>{});

    video.onloadedmetadata = () => {
      video.play();
      setStatus(`‚úÖ Camera streaming ${video.videoWidth}√ó${video.videoHeight}`);

      // ‚úÖ Start render loop once video is ready
      requestAnimationFrame(drawLoop);
    };

  } catch(e){
    console.error(e);
    setStatus("‚ùå Camera failed to start");
  }
}

/* ‚úÖ Draw loop ‚Äî shows live video feed */
function drawLoop(){
  if (video.readyState === 4) {
    ctx.drawImage(video,0,0,canvas.width,canvas.height);
  }
  requestAnimationFrame(drawLoop);
}

/* Button binding */
startBtn.onclick = startCamera;
</script>

</body>
</html>
