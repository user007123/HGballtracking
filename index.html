<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>HoverGreens Vision Debug — Pixel Finder</title>
<style>
  body{margin:0;background:#000;color:#0f0;font-family:Arial;text-align:center;}
  canvas{background:#000;margin:8px auto;display:block;border:1px solid #333;}
  #info{margin-top:5px;font-size:14px;}
</style>
</head>
<body>

<h3>HoverGreens Vision — Ball Pixel Debug Mode</h3>
<div id="info">Move mouse over ball — checking pixel values…</div>

<video id="vid" autoplay playsinline muted style="display:none"></video>
<canvas id="view" width="960" height="540"></canvas>
<canvas id="zoom" width="120" height="120"></canvas>
<canvas id="mask" width="960" height="540"></canvas>

<script>
const vid=document.getElementById("vid");
const view=document.getElementById("view");
const vctx=view.getContext("2d",{willReadFrequently:true});
const zoom=document.getElementById("zoom");
const zctx=zoom.getContext("2d",{willReadFrequently:true});
const mask=document.getElementById("mask");
const mctx=mask.getContext("2d",{willReadFrequently:true});
const info=document.getElementById("info");

// ✅ camera request with fallback
navigator.mediaDevices.getUserMedia({
  video:{width:{ideal:1920},height:{ideal:1080},facingMode:"environment"},
  audio:false
}).then(s=>{
  vid.srcObject=s;
  vid.onloadedmetadata=()=>vid.play();
});

view.onmousemove=e=>{
  const rect=view.getBoundingClientRect();
  const x=Math.floor((e.clientX-rect.left)/rect.width*view.width);
  const y=Math.floor((e.clientY-rect.top)/rect.height*view.height);

  // crop zoom
  const size=20;
  zctx.imageSmoothingEnabled=false;
  zctx.drawImage(view, x-size, y-size, size*2, size*2, 0,0,120,120);

  // pixel info
  const p=vctx.getImageData(x,y,1,1).data;
  const [r,g,b]=p;
  const brightness=(r+g+b)/3|0;
  const sat=(Math.max(r,g,b)-Math.min(r,g,b))/(Math.max(r,g,b)+1);

  info.textContent=`Pixel @${x},${y} :: R${r} G${g} B${b} | Bright ${brightness} | Sat ${sat.toFixed(2)}`;
};

// frame loop
function loop(){
  vctx.drawImage(vid,0,0,view.width,view.height);

  // white mask preview
  const frame=vctx.getImageData(0,0,view.width,view.height);
  const data=frame.data;
  const out=mctx.getImageData(0,0,view.width,view.height);
  const odata=out.data;

  for(let i=0;i<data.length;i+=4){
    const r=data[i],g=data[i+1],b=data[i+2];
    const brightness=(r+g+b)/3;
    const sat=(Math.max(r,g,b)-Math.min(r,g,b))/(Math.max(r,g,b)+1);

    const isWhite = brightness>160 && sat<0.28;
    odata[i]=odata[i+1]=odata[i+2] = isWhite ? 255 : 0;
    odata[i+3] = 255;
  }
  mctx.putImageData(out,0,0);

  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>
