<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>HoverGreens Ball Vision ‚Äî Boot Test</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
  body { margin:0; background:#000; color:#fff; font-family:Arial; text-align:center; }
  #status { font-size:18px; padding:8px; }
  video, canvas { width:1180px; height:370px; background:#111; display:block; margin:10px auto; }
</style>

<!-- ‚úÖ Load OpenCV FIRST ‚Äî no async -->
<script src="https://cdn.jsdelivr.net/npm/@techstark/opencv-js@4.7.0/dist/opencv.js"></script>

<script>
let cvReady = false;

cv['onRuntimeInitialized'] = () => {
  cvReady = true;
  const box = document.getElementById("status");
  box.textContent = "‚úÖ OpenCV Ready ‚Äî drawing enabled";
  if (typeof loop === "function") requestAnimationFrame(loop);
};
</script>

</head>
<body>

<h2>HoverGreens Vision ‚Äî Camera + OpenCV Boot</h2>
<div id="status">‚è≥ Initializing camera & OpenCV‚Ä¶</div>

<video id="cam" autoplay playsinline></video>
<canvas id="view" width="1180" height="370"></canvas>

<script>
const statusBox = document.getElementById("status");
const video = document.getElementById("cam");
const canvas = document.getElementById("view");
const ctx = canvas.getContext("2d");

// ‚úÖ Start camera
navigator.mediaDevices.getUserMedia({ video:true })
.then(stream => {
  video.srcObject = stream;
  video.onloadedmetadata = () => video.play();
  statusBox.textContent = "üì∑ Camera started ‚Äî waiting for OpenCV‚Ä¶";
})
.catch(err => {
  statusBox.textContent = "‚ùå Camera blocked ‚Äî enable permissions";
});

// ‚úÖ Draw loop ‚Äî runs ONLY after OpenCV ready
function loop() {
  // draw mirrored cam feed
  ctx.save();
  ctx.scale(-1,1);
  ctx.drawImage(video, -canvas.width, 0, canvas.width, canvas.height);
  ctx.restore();

  // ‚úÖ debug dot ‚Äî PROVES drawing works
  ctx.fillStyle = "white";
  ctx.beginPath();
  ctx.arc(50, 50, 12, 0, Math.PI*2);
  ctx.fill();

  requestAnimationFrame(loop);
}
</script>

</body>
</html>
